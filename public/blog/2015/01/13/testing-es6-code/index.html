<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  	<meta property="og:title" content=" Testing ES6 code &middot;  Thomas Coopman - Infinite Tree" />
  	<meta property="og:site_name" content="Thomas Coopman - Infinite Tree" />
  	<meta property="og:url" content="https://infinitetree.eu/blog/2015/01/13/testing-es6-code/" />

    
  	<meta property="og:type" content="article" />

    <meta property="og:article:published_time" content="2015-01-13T00:00:00Z" />

    
    <meta property="og:article:tag" content="es6" />
    
    <meta property="og:article:tag" content="react" />
    
    <meta property="og:article:tag" content="webpack" />
    
    


  <title>
     Testing ES6 code &middot;  Thomas Coopman - Infinite Tree
  </title>

    <meta name="description" content="Thomas Coopman - Software Consultant" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://infinitetree.eu/images/favicon.ico">
	  <link rel="apple-touch-icon" href="https://infinitetree.eu/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="https://infinitetree.eu/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://infinitetree.eu/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
          <link href="https://infinitetree.eu/index.xml" rel="alternate" type="application/rss+xml" title="Thomas Coopman - Infinite Tree" />
      
      
    
    <meta name="generator" content="Hugo 0.27.1" />

    <link rel="canonical" href="https://infinitetree.eu/blog/2015/01/13/testing-es6-code/" />

    
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-56701000-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/">Blog</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/contact">Contact</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/resume">Resume</a>
            </li>
        
            <h3>Follow me</h3>
            <li class="nav-opened" role="presentation">
            	<a href="https://twitter.com/tcoopman">Twitter timeline</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://github.com/tcoopman/">Github repos</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://bitbucket.org/tcoopman/">Bitbucket repos</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://www.linkedin.com/in/thomas-coopman-a6860622?trk=hp-identity-name">Linkedin</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://plus.google.com/u/0/109624499308077610663">Google Plus</a>
            </li>
        
    </ul>
    
    
    <a class="subscribe-button icon-feed" href="https://infinitetree.eu/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">




<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Testing ES6 code</h1>
        <small>Testing with webpack and ES6</small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2015-01-13T00:00:00Z">
            Jan 13, 2015
          </time>
        
         
          <span class="post-tag small"><a href="https://infinitetree.eu/tags/es6/">#es6</a></span>
         
          <span class="post-tag small"><a href="https://infinitetree.eu/tags/react/">#react</a></span>
         
          <span class="post-tag small"><a href="https://infinitetree.eu/tags/webpack/">#webpack</a></span>
         
        </section>
    </header>

    <section class="post-content">
      

<p>Recently, I&rsquo;ve changed my webpack workflow, and switched to <a href="https://6to5.org/">6to5</a>, to be able to write more of my React code in ES6 than the current jsx transpiler supports (and because 6to5 just rocks!). You can find this workflow in my <a href="https://github.com/tcoopman/boilerplate-webpack-react">boilerplate-webpack-react</a> project. Switching was easy. I&rsquo;ve just replaced jsx-loader with 6to5-loader and everything worked correctly.</p>

<p>Writing code and developing is a breeze with this workflow, especially with <a href="https://github.com/gaearon/react-hot-loader">react-hot-loader</a>. I didn&rsquo;t look into writing test though yet, and it took me a little while to find out how to do it, so I explain it here.</p>

<h2 id="karma-webpack">Karma-webpack</h2>

<p>Luckely, there exist a <a href="http://karma-runner.github.io/">karma</a> plugin <a href="https://github.com/webpack/karma-webpack">webpack-karma</a> that allows you to run webpack on files loaded by karma. This means, the test can be written in ES6 (or any other language you prefer that can be transpiled by a webpack loader), and your own code also gets transpiled.</p>

<p>Let me show my setup.</p>

<h3 id="install-dependencies">Install dependencies</h3>

<p>First you need to install all dependencies:</p>

<p><code>npm install --save-dev karma karma-mocha karma-webpack karma-chrome-launcher should</code></p>

<p>I use <a href="http://mochajs.org/">mocha</a> as test framework and <a href="https://github.com/shouldjs/should.js">should</a> as assertion library, but this should work with anything that karma supports.</p>

<h3 id="karma-configuration-file">Karma configuration file</h3>

<p>Next we need to create the karma config file <em>karma.conf.js</em></p>
// Karma configuration
var path = require('path');

module.exports = function(config) {
  config.set({
    // ... normal karma configuration

    files: [
    // all files ending in "_test"
    'test/*_test.jsx',
    'test/**/*_test.jsx'
    // each file acts as entry point for the webpack configuration
    ],


    frameworks: ['mocha'],


    browsers: ['Chrome'],


    preprocessors: {
      // add webpack as preprocessor
      'test/data/*.jsx': ['webpack'],
      'test/*_test.jsx': ['webpack'],
      'test/**/*_test.jsx': ['webpack']
    },

    webpack: {
      // webpack configuration
      output: {
        path: path.join(__dirname, 'dist'),
        publicPath: '/',
        filename: 'app.js',
        chunkFilename: '[chunkhash].js'
      },


      resolve: {
        extensions: ['', '.js', '.jsx', '.styl'],
        packageMains: ["webpack", "browser", "web", "browserify", "main"]
      },


      module: {
        loaders: [
          {test: /\.jsx$/, loaders: ['6to5-loader'] }
        ]
      }
    },


    webpackMiddleware: {
      // webpack-dev-middleware configuration
      // i. e.
      noInfo: true
    },

    plugins: [
      require('karma-chrome-launcher'),
      require('karma-mocha'),
      require('karma-webpack')
    ]

  });
};

<h3 id="first-test">First test</h3>

<p>We also add a simple _sanity<em>test</em> to make sure everything is setup correctly</p>
import should from 'should';

describe('sanity test', () => {
  it('true should be true', () => {
    true.should.be.ok;
  });
});

<h3 id="first-run">First run</h3>

<p>Now, if we want to run our test, we run:</p>

<p><code>node node_modules/karma/bin/karma start karma.conf.js</code></p>

<p>This should start Chrome (if you don&rsquo;t have chrome, see the <a href="http://karma-runner.github.io/0.12/config/browsers.html">karma browser configuration</a>) and print this:</p>
INFO [karma]: Karma v0.12.31 server started at http://localhost:9876/
INFO [launcher]: Starting browser Chrome
INFO [Chrome 39.0.2171 (Windows 7)]: Connected on socket xBMICOzH9lh3Eo9INXDA with id 55389724
Chrome 39.0.2171 (Windows 7): Executed 1 of 1 SUCCESS (0.009 secs / 0 secs)

<p>Every time you change your code it will automatically rerun your tests.</p>

<p>To make it a bit easier to run the test, add the test command to npm:</p>
"scripts": {
  "test": "node node_modules/karma/bin/karma start karma.conf.js"
}

<p>You could also add <code>--single-run</code> if you want to run the test only once and don&rsquo;t watch.</p>

<h2 id="testing-react-code">Testing React code</h2>

<p>The steps above give you a working testing environment, now we can test our code:</p>

<p>To test this we create a simple React component <em>Button.react.jsx</em>:</p>
import React from 'react';


export default React.createClass({
  displayName: 'Button',


  render() {
    return <div>button</div>;
  }
});

<p>And we test it in _Button.react<em>test.jsx</em>:</p>
import React from 'react/addons';
import should from 'should';

import Button from '../app/jsx/components/Button.react';

const TestUtils = React.addons.TestUtils;


describe('Button', () => {
  it('renders button div', () => {
    const button = TestUtils.renderIntoDocument(
      <Button />
    );
    TestUtils.isCompositeComponent(button).should.be.ok;
    button.getDOMNode().textContent.should.be.eql('button');
  });
});

<p><strong>Easy!</strong></p>

<h3 id="remark">Remark</h3>

<p>While testing, I ran into a problem. This line in HelloWorld.react.jsx: <code>var exampleImage = require('../../images/example.jpg');</code> proved to be a problem. But the problem was quiet obvious to solve, I just needed to add a image loader to the karma webpack configuration:</p>
module: {
  loaders: [
  {test: /\.jsx$/, loaders: ['6to5-loader'] },
  // Add the image loader
  {test: /.*\.(gif|png|jpg)$/, loaders: ['file?hash=sha512&digest=hex&size=16&name=[hash].[ext]', 'image-webpack-loader?optimizationLevel=7&interlaced=false']}
  ]
}

<p>After this, I could test the HelloWorld component too.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Once you have this up, you can test your code with the same setup you already have. Webpack rocks!</p>

<p>If you have any questions, please leave them as an issue at my boilerplate repository (<a href="https://github.com/tcoopman/boilerplate-webpack-react/issues">https://github.com/tcoopman/boilerplate-webpack-react/issues</a>)</p>

<h2 id="commits">Commits</h2>

<p>All steps and code above can be found in the commits between tag 0.0.9 and 0.0.10: <a href="https://github.com/tcoopman/boilerplate-webpack-react/commits/master">https://github.com/tcoopman/boilerplate-webpack-react/commits/master</a></p>

    </section>


  <footer class="post-footer">


    

    





<section class="author">
  <h4><a href="https://infinitetree.eu/">Thomas Coopman</a></h4>
  
  <p>Software Consultant</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Belgium</span>
    <span class="author-link icon-link"><a href="https://infinitetree.eu">https://infinitetree.eu</a></span>
  </div>
</section>



    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Testing%20ES6%20code&amp;url=https%3a%2f%2finfinitetree.eu%2fblog%2f2015%2f01%2f13%2ftesting-es6-code%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2finfinitetree.eu%2fblog%2f2015%2f01%2f13%2ftesting-es6-code%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2finfinitetree.eu%2fblog%2f2015%2f01%2f13%2ftesting-es6-code%2f&amp;description=Testing%20ES6%20code"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2finfinitetree.eu%2fblog%2f2015%2f01%2f13%2ftesting-es6-code%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'thomascoopmaneu';
  var disqus_url = 'https:\/\/infinitetree.eu\/blog\/2015\/01\/13\/testing-es6-code\/';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




  </footer>
</article>

</main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Thomas Coopman - Infinite Tree</a> </section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="https://infinitetree.eu/js/jquery.js"></script>
    <script type="text/javascript" src="https://infinitetree.eu/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://infinitetree.eu/js/index.js"></script>
    
</body>
</html>

